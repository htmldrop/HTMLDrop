import{C as S}from"./Card-xN9auaPp.js";import{_,b as n,e as a,p as g,d as v,q as T,F as c,g as i,t as r,s as m,v as y,l as U,h as k,w as d,k as F,f as w,T as B,y as C}from"./index-BbKfwM1B.js";const P={components:{Card:S},inject:["translate","apiBase","apiFetch","navTree","controls","getControl"],props:["slug","sub"],data:()=>({fileupload:!1,postType:null,postTypeFields:[],postTypeTaxonomies:[],title:"",newSlug:"",status:"draft",obj:{terms:{}},termSearch:{},termResults:{},searchTermsDebounced:null}),created(){this.searchTermsDebounced=this.debounce(this.searchTerms,300),this.navTree&&!this.node?.vue_instance&&this.init()},computed:{node(){const e=this.navTree?.find(s=>s.slug===this.slug);return this.sub&&e?.children?.find(s=>s.slug===this.sub)||e},isCreating(){return this.sub==="new"},featuredImage(){return this.postTypeFields?.find(e=>e.field.slug==="featured_image"&&e.field.type==="media")}},watch:{navTree(e){e&&!this.node?.vue_instance&&!this.postType&&this.init()},slug(){this.navTree&&!this.node?.vue_instance&&this.init()},sub(){this.navTree&&!this.node?.vue_instance&&this.init()}},methods:{getTermsOptions(e,s){return this.termResults?.[s]||[]},debounce(e,s=300){let o;return(...f)=>{clearTimeout(o),o=setTimeout(()=>e.apply(this,f),s)}},async searchTerms(e,s){const o=this.obj?.terms?.[e]||[];if(!s){this.termResults[e]=[...o];return}const V=(await(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/terms/${e}?search=${encodeURIComponent(s)}`)).json())?.items||[],l=[...o];for(const j of V)l.find(b=>b.id===j.id)||l.push(j);this.termResults[e]=l},async init(){this.postType=null,this.postTypeFields=[],this.postTypeTaxonomies=[],this.title="",this.newSlug="",this.status="draft",this.obj={terms:{}},await Promise.all([this.getPostType(),this.getPostTypeFields(),this.getPostTypeTaxonomies()]);for(const{slug:e}of this.postTypeTaxonomies||[])this.obj.terms[e]=[],this.termResults[e]=[];await this.getPost(),this.isCreating&&(this.newSlug="")},async getPostType(){const e=await this.apiFetch(`${this.apiBase}/api/v1/post-types/${this.slug}`);this.postType=await e.json()},async getPostTypeFields(){const s=await(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/fields`)).json();typeof s?.sort=="function"&&(this.postTypeFields=s.sort((o,f)=>o.field.order-f.field.order))},async getPostTypeTaxonomies(){const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/taxonomies`);this.postTypeTaxonomies=await e.json()},async getPost(){if(!this.slug||this.isCreating)return;const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${this.sub}`);this.asign(await e.json())},async save(){try{if(this.obj?.id){const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${this.obj.id}`,{method:"PATCH",body:JSON.stringify({...this.obj,title:this.title,slug:this.newSlug})});this.asign(await e.json()),this.obj.slug&&this.obj.slug!==this.slug?this.$router.push("/"+this.slug+"/"+this.obj.slug):!this.obj.slug&&this.obj.id!==this.slug&&this.$router.push("/"+this.slug+"/"+this.obj.id)}else{const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}`,{method:"POST",body:JSON.stringify({title:this.title,slug:this.newSlug,...this.obj})});this.asign(await e.json()),this.$router.push("/"+this.slug+"/"+(this.obj.slug||this.obj.id))}}catch(e){console.error(e),alert(`Something went wrong: ${e.message}`)}},asign(e){this.newSlug=e.slug,this.title=e.title;const s=Object.fromEntries(Object.entries(e));s.terms||(s.terms={});for(const{slug:o}of this.postTypeTaxonomies||[])s.terms[o]||(s.terms[o]=[]);this.obj=s;for(const{slug:o}of this.postTypeTaxonomies||[])this.termResults[o]=[...this.obj.terms[o]]}}},I={key:1,style:{padding:"20px 20px 50px"}},R={style:{margin:"0 0 20px"}},M={class:"wrapper"},N={class:"content"},O={key:0,class:"title"},D=["placeholder"],L={key:1,class:"slug"},E=["placeholder"],H={class:"permalink"},J={style:{width:"15px","margin-right":"5px"},xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 52 52","xml:space":"preserve"},q={class:"grid"},A={class:"fields"},G={class:"field"},z=["onUpdate:modelValue"],K=["onUpdate:modelValue"],Q=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X=["onUpdate:modelValue"],Y=["value"],Z={key:6},x={class:"grid"},$={class:"publish-row"},ee=["value"],te={class:"publish-row"},se=["disabled"],le=["disabled"],ie={style:{display:"flex","flex-direction":"column"}},ae=["onUpdate:modelValue","onInput","placeholder"],oe=["onUpdate:modelValue"],ne=["value"];function re(e,s,o,f,V,l){const j=F("router-link"),b=F("card");return l.node?.vue_instance?(a(),n(c,{key:0},[o.sub&&l.navTree?(a(),g(T("drop-"+o.slug+"-"+o.sub),{key:0,slug:o.slug,sub:o.sub},null,8,["slug","sub"])):l.navTree?(a(),g(T("drop-"+o.slug),{key:1,slug:o.slug,sub:o.sub},null,8,["slug","sub"])):v("",!0)],64)):(a(),n("div",I,[i("h1",R,r(l.isCreating?l.translate("New"):l.translate("Update"))+" "+r(l.node?.name_singular),1),i("div",M,[i("div",N,[e.postTypeFields?.find(t=>t.field.slug==="title")?(a(),n("div",O,[m(i("input",{placeholder:l.translate("Title"),"onUpdate:modelValue":s[0]||(s[0]=t=>e.title=t)},null,8,D),[[y,e.title]])])):v("",!0),e.postTypeFields?.find(t=>t.field.slug==="slug")?(a(),n("div",L,[m(i("input",{placeholder:l.translate("Slug"),"onUpdate:modelValue":s[1]||(s[1]=t=>e.newSlug=t)},null,8,E),[[y,e.newSlug]])])):v("",!0),i("div",H,[U(r(l.translate("Permalink"))+": ",1),s[8]||(s[8]=i("a",{href:"https://",target:"_blank"},"https://",-1))]),i("div",null,[k(j,{class:"button",to:"/"+o.slug},{default:d(()=>[(a(),n("svg",J,[...s[9]||(s[9]=[i("path",{d:"M48.6 23H15.4c-.9 0-1.3-1.1-.7-1.7l9.6-9.6c.6-.6.6-1.5 0-2.1l-2.2-2.2c-.6-.6-1.5-.6-2.1 0L2.5 25c-.6.6-.6 1.5 0 2.1L20 44.6c.6.6 1.5.6 2.1 0l2.1-2.1c.6-.6.6-1.5 0-2.1l-9.6-9.6c-.6-.7-.2-1.8.7-1.8h33.2c.8 0 1.5-.6 1.5-1.4v-3c0-.8-.6-1.6-1.4-1.6"},null,-1)])])),U(" "+r(l.translate("Go back to"))+" "+r(l.translate(l.node?.name_plural)),1)]),_:1},8,["to"])]),i("div",q,[k(b,null,{header:d(()=>[i("h2",null,r(l.translate("Fields")),1)]),footer:d(()=>[...s[10]||(s[10]=[])]),default:d(()=>[i("div",A,[(a(!0),n(c,null,w(e.postTypeFields?.filter(t=>!["slug","title","featured_image","status"].includes(t.field.slug)),({field:t,priority:h,source:p})=>(a(),n("div",G,[i("label",null,r(l.translate(t.name))+" "+r(t.required?"*":""),1),t.type==="text"?m((a(),n("input",{key:0,"onUpdate:modelValue":u=>e.obj[t.slug]=u},null,8,z)),[[y,e.obj[t.slug]]]):t.type==="number"?m((a(),n("input",{key:1,type:"number","onUpdate:modelValue":u=>e.obj[t.slug]=u},null,8,K)),[[y,e.obj[t.slug]]]):t.type==="editor"?m((a(),n("textarea",{key:2,"onUpdate:modelValue":u=>e.obj[t.slug]=u},null,8,Q)),[[y,e.obj[t.slug]]]):t.type==="textarea"?m((a(),n("textarea",{key:3,"onUpdate:modelValue":u=>e.obj[t.slug]=u},null,8,W)),[[y,e.obj[t.slug]]]):t.type==="select"?m((a(),n("select",{key:4,"onUpdate:modelValue":u=>e.obj[t.slug]=u},[(a(!0),n(c,null,w(t.options?.choices,u=>(a(),n("option",{value:u},r(u),9,Y))),256))],8,X)),[[C,e.obj[t.slug]]]):l.controls?.find(u=>u.slug===t.type)?(a(),g(T(l.getControl(t.type)),{key:5,large:!0,postType:o.slug,modelValue:e.obj[t.slug],"onUpdate:modelValue":u=>e.obj[t.slug]=u,field:t,priority:h,source:p,item:e.obj},null,8,["postType","modelValue","onUpdate:modelValue","field","priority","source","item"])):(a(),n("div",Z,"Unsupported field: "+r(t),1))]))),256))])]),_:1})])]),i("div",x,[k(b,null,{header:d(()=>[i("h2",null,r(l.translate("Publish")),1)]),footer:d(()=>[i("button",{disabled:l.isCreating,onClick:s[3]||(s[3]=t=>(e.status="trashed",l.save()))},r(l.translate("Move to trash")),9,le),l.isCreating?(a(),n("button",{key:0,onClick:s[4]||(s[4]=(...t)=>l.save&&l.save(...t))},r(l.translate("Create")),1)):(a(),n("button",{key:1,onClick:s[5]||(s[5]=(...t)=>l.save&&l.save(...t))},r(l.translate("Update")),1))]),default:d(()=>[i("div",$,[s[11]||(s[11]=i("div",{class:"icon"},[i("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M9 6a3 3 0 0 1 3-3h0a3 3 0 0 1 3 3h0a3 3 0 0 1-3 3h0a3 3 0 0 1-3-3m3 3v12",style:{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"}})])],-1)),i("label",null,r(l.translate("Status"))+":",1),m(i("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>e.status=t)},[(a(!0),n(c,null,w(e.postTypeFields?.find(t=>t.field.slug==="status")?.field?.options?.choices||[],t=>(a(),n("option",{value:t},r(t),9,ee))),256))],512),[[C,e.status]])]),i("div",te,[s[12]||(s[12]=i("div",{class:"icon"},[i("svg",{width:"15px",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 338.784 338.784","xml:space":"preserve"},[i("path",{d:"M18.93 168.462C18.93 85.497 86.427 18 169.392 18c41.483 0 80.871 17.046 109.254 47.017h-7.688a9 9 0 0 0-9 9 9 9 0 0 0 9 9h30.522a9 9 0 0 0 9-9V43.494c0-4.971-4.029-9-9-9s-9 4.029-9 9v9.971C260.649 19.401 216.217 0 169.392 0 76.502 0 .93 75.572.93 168.462c0 40.967 14.882 80.454 41.903 111.188a8.98 8.98 0 0 0 6.763 3.057 8.97 8.97 0 0 0 5.938-2.241 9 9 0 0 0 .816-12.702c-24.13-27.446-37.42-62.712-37.42-99.302m308.191-59.294a9 9 0 1 0-16.848 6.336c6.357 16.905 9.581 34.723 9.581 52.958 0 82.965-67.497 150.461-150.462 150.461-24.007 0-47.843-5.792-69.014-16.738l8.134-2.88a9 9 0 0 0-6.009-16.967l-28.771 10.189a9 9 0 0 0-5.479 11.488l10.189 28.771a9 9 0 0 0 8.483 5.998 9 9 0 0 0 8.484-12.007l-2.993-8.45c23.641 12.16 50.217 18.596 76.976 18.596 92.891 0 168.462-75.571 168.462-168.461 0-20.406-3.611-40.356-10.733-59.294"}),i("path",{d:"M169.392 56.371c-61.132 0-110.866 49.734-110.866 110.866s49.734 110.866 110.866 110.866 110.866-49.734 110.866-110.866c.001-61.132-49.734-110.866-110.866-110.866m85.112 119.866h7.317c-4.255 44.037-39.392 79.174-83.429 83.429v-7.317a9 9 0 0 0-9-9 9 9 0 0 0-9 9v7.317c-44.037-4.255-79.174-39.392-83.429-83.428h7.317c4.971 0 9-4.029 9-9s-4.029-9-9-9h-7.317c4.255-44.037 39.392-79.174 83.429-83.429v7.317a9 9 0 0 0 9 9 9 9 0 0 0 9-9v-7.317c44.037 4.255 79.174 39.392 83.429 83.428h-7.317a9 9 0 0 0-9 9 9 9 0 0 0 9 9"}),i("path",{d:"M209.864 167.286h-31.472v-48.79a9 9 0 0 0-9-9 9 9 0 0 0-9 9v57.79a9 9 0 0 0 9 9h40.472c4.971 0 9-4.029 9-9s-4.029-9-9-9"})])],-1)),i("label",null,r(l.translate("Revisions"))+":",1),i("button",{disabled:l.isCreating},r(l.translate("Browse")),9,se)])]),_:1}),l.featuredImage?(a(),g(b,{key:0},{header:d(()=>[i("h2",null,r(l.translate("Featured image")),1)]),footer:d(()=>[...s[13]||(s[13]=[])]),default:d(()=>[(a(),g(T(l.getControl("media")),{large:!0,modelValue:e.obj.featured_image,"onUpdate:modelValue":s[6]||(s[6]=t=>e.obj.featured_image=t),postType:o.slug,field:l.featuredImage.field,priority:l.featuredImage.priority,source:l.featuredImage.source,item:e.obj},null,8,["modelValue","postType","field","priority","source","item"]))]),_:1})):v("",!0),(a(!0),n(c,null,w(e.postTypeTaxonomies||[],({name_plural:t,slug:h})=>(a(),n(c,{key:"taxonomy_"+h},[e.obj.terms&&e.obj.terms[h]!==void 0?(a(),g(b,{key:0},{header:d(()=>[i("h2",null,r(l.translate(t)),1)]),footer:d(()=>[...s[14]||(s[14]=[])]),default:d(()=>[i("div",ie,[m(i("input",{type:"text","onUpdate:modelValue":p=>e.termSearch[h]=p,onInput:p=>e.searchTermsDebounced(h,e.termSearch[h]),placeholder:"Search "+h},null,40,ae),[[y,e.termSearch[h]]]),m(i("select",{multiple:"","onUpdate:modelValue":p=>e.obj.terms[h]=p,style:{height:"100px"}},[(a(!0),n(c,null,w(e.termResults[h]||[],p=>(a(),n("option",{key:p.id,value:p},r(p.title||p.slug),9,ne))),128))],8,oe),[[C,e.obj.terms[h]]])])]),_:2},1024)):v("",!0)],64))),128))])]),(a(),g(B,{to:"body"},[e.fileupload?(a(),g(T(l.getControl("mediaselector")),{key:0,postType:"attachments",field:e.field,priority:e.priority,source:e.source,item:e.item,multi:!1,onClose:s[7]||(s[7]=t=>e.fileupload=!1)},null,40,["field","priority","source","item"])):v("",!0)]))]))}const he=_(P,[["render",re],["__scopeId","data-v-25588732"]]);export{he as default};
