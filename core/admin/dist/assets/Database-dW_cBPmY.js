import{W as u}from"./wizard-D9tJqFkq.js";import{_ as h,p as m,e as r,w as f,k as b,g as a,s as i,b as l,d as n,y as v,v as o,t as y}from"./index-7XmMreNC.js";import"./Logo-BcDt0wYT.js";const g={inject:["apiBase"],components:{Wizard:u},data:()=>({health:{},driver:"mysql2",host:"",database:"",user:"",password:"",prefix:"hd_",timeout:null,port:"",attempts:0,maxAttempts:20,hasFailed:!1}),async created(){localStorage.removeItem("tokens"),this.health=await this.getHealth()},computed:{connection(){return this.driver==="better-sqlite3"?{filename:"./content/config/htmldrop.db"}:{port:this.port||(this.driver==="pg"?5432:3306),host:this.host,database:this.database,user:this.user,password:this.password}}},watch:{health(t){t?.checks?.find(e=>e.slug==="database")?.ok&&this.$router.push("/setup/admin")}},beforeUnmount(){this.timeout&&clearTimeout(this.timeout)},methods:{async getHealth(){return(await fetch(`${this.apiBase}/api/v1/health`)).json()},async submit(){try{await fetch(`${this.apiBase}/api/v1/setup/database`,{method:"POST",body:JSON.stringify({client:this.driver,connection:this.connection,prefix:this.prefix})}),this.checkHealth()}catch(t){console.error(t),alert(t.message)}},async checkHealth(t=!0){this.timeout&&(clearTimeout(this.timeout),t&&(this.attempts=0)),this.health=await this.getHealth(),this.health?.checks?.some(e=>e.slug==="database"&&e.ok)?this.$router.push("/setup/admin"):this.attempts<this.maxAttempts?(this.attempts++,this.timeout=setTimeout(()=>this.checkHealth(!1),1e3)):(this.attempts=0,this.timeout=null,this.hasFailed=!0)}}},k={key:0,class:"form"},w=["placeholder"],c=["disabled"],S={key:1},U={key:2};function V(t,e,H,T,B,d){const p=b("Wizard");return r(),m(p,{step:0},{default:f(()=>[e[9]||(e[9]=a("h1",null,"Get Started Quickly with HTMLDrop",-1)),e[10]||(e[10]=a("h2",null,"Select database driver",-1)),i(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.driver=s)},[...e[8]||(e[8]=[a("option",{value:"mysql2"},"MySQL",-1),a("option",{value:"pg"},"PostgreSQL",-1),a("option",{value:"better-sqlite3"},"SQLite",-1)])],512),[[v,t.driver]]),t.driver!=="better-sqlite3"?(r(),l("div",k,[i(a("input",{placeholder:"Host","onUpdate:modelValue":e[1]||(e[1]=s=>t.host=s)},null,512),[[o,t.host]]),i(a("input",{placeholder:"Port "+(t.driver==="pg"?5432:3306),"onUpdate:modelValue":e[2]||(e[2]=s=>t.port=s)},null,8,w),[[o,t.port]]),i(a("input",{placeholder:"Database","onUpdate:modelValue":e[3]||(e[3]=s=>t.database=s)},null,512),[[o,t.database]]),i(a("input",{placeholder:"User","onUpdate:modelValue":e[4]||(e[4]=s=>t.user=s)},null,512),[[o,t.user]]),i(a("input",{placeholder:"Password",type:"password","onUpdate:modelValue":e[5]||(e[5]=s=>t.password=s)},null,512),[[o,t.password]])])):n("",!0),i(a("input",{placeholder:"Table prefix","onUpdate:modelValue":e[6]||(e[6]=s=>t.prefix=s)},null,512),[[o,t.prefix]]),a("button",{onClick:e[7]||(e[7]=(...s)=>d.submit&&d.submit(...s)),disabled:t.timeout},"Submit",8,c),t.timeout?(r(),l("div",S," Trying to setup database - "+y(t.maxAttempts-t.attempts)+" ... ",1)):t.hasFailed?(r(),l("div",U," Could not connect to database, please verify your input & try again. ")):n("",!0)]),_:1})}const D=h(g,[["render",V],["__scopeId","data-v-190d04f4"]]);export{D as default};
