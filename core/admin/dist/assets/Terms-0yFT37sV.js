import{_ as O,b as d,e as r,p as m,d as f,q as k,F as y,g as l,h as S,t as a,w as T,k as B,T as U,m as C,s as g,v as b,x as V,y as I,z as p,f as v,l as A}from"./index-B0MWj9mE.js";const N={inject:["translate","apiBase","apiFetch","navTree","controls","getControl"],props:["slug","taxonomy","sub"],data:()=>({action:"",postType:null,postTypeFields:[],taxonomyItem:null,taxonomyFields:[],response:{},responseOriginal:{},allSelected:!1,selectedItems:[],tab:"all",offset:0,limit:10,parent_id:null,search:"",searchable:["slug","title"],orderBy:"",sort:"",mediaUploader:!1}),created(){this.init()},mounted(){this.syncActionCellWidths(),window.addEventListener("resize",this.syncActionCellWidths)},beforeUnmount(){window.removeEventListener("resize",this.syncActionCellWidths)},computed:{node(){const s=this.navTree?.find(o=>o.slug===this.slug)?.children?.find(o=>o.slug===`terms/${this.taxonomy}`);return this.sub&&s?.children?.find(o=>o.slug===this.sub)||s}},watch:{slug(){this.tab="all",this.init()},sub(){this.init()},taxonomy(){this.init()},response(e){this.$nextTick(()=>this.syncActionCellWidths())},tab(){this.init()}},methods:{hasChanges(e){const s=this.responseOriginal?.items.find(o=>o.id===e.id);return JSON.stringify(e)!==JSON.stringify(s)},getChanges(e){const s={},o=this.responseOriginal?.items.find(h=>h.id===e.id);for(const h of Object.keys(e))o?.[h]!==e[h]&&(s[h]=e[h]);return s},async runBulk(e){const s=this.response.items.filter(o=>this.selectedItems.includes(o.id));if(e==="trash")for(const o of s)this.trash(o);else if(e==="delete"){if(!confirm("Permanently delete all selected?"))return;for(const o of s)this.trash(o,!0,!0)}else if(e==="restore")for(const o of s)this.restore(o);else if(e==="save")for(const o of s)this.save(o);else if(e==="duplicate"){const o=[];for(const h of s){const u=JSON.parse(JSON.stringify(h));u.slug&&(u.slug+="-"+Date.now()),delete u.id,delete u.created_at,delete u.updated_at,o.push(this.create(u))}await Promise.all(o),this.getItems()}},async create(e){await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/terms/${this.taxonomy}`,{method:"POST",body:JSON.stringify(e)})},async save(e){const s=this.responseOriginal?.items.find(t=>t.id===e.id),o=s.status,u=await(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/terms/${this.taxonomy}/${e.id}`,{method:"PATCH",body:JSON.stringify(this.getChanges(e))})).json();for(const t of Object.keys(u))e[t]=u[t],s[t]=u[t];e.status!==o&&(e.status==="draft"&&this.response.total_drafts++,e.status==="published"&&this.response.total_published++,o==="draft"&&this.response.total_drafts--,o==="published"&&this.response.total_published--)},async trash(e,s=!1,o=!1){const u=(this.responseOriginal?.items.find(t=>t.id===e.id)).status;!o&&s&&!confirm("Delete permanently?")||(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/terms/${this.taxonomy}/${e.id}${s?"?permanently=true":""}`,{method:"DELETE"}),this.responseOriginal.items=this.responseOriginal.items.filter(t=>t.id!==e.id),this.response.items=this.response.items.filter(t=>t.id!==e.id),e.deleted_at||(u==="draft"&&this.response.total_drafts--,u==="published"&&this.response.total_published--,this.response.total_trashed++,this.response.total--),s&&(u==="draft"&&this.response.total_drafts++,u==="published"&&this.response.total_published++,this.response.total_trashed-=2,this.response.total++))},async restore(e){const o=(this.responseOriginal?.items.find(h=>h.id===e.id)).status;await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/terms/${this.taxonomy}/${e.id}`,{method:"PATCH",body:JSON.stringify({deleted_at:null})}),this.responseOriginal.items=this.responseOriginal.items.filter(h=>h.id!==e.id),this.response.items=this.response.items.filter(h=>h.id!==e.id),this.response.total_trashed--,this.response.total++,o==="draft"&&this.response.total_drafts++,o==="published"&&this.response.total_published++},async init(){this.postType=null,this.postTypeFields=[],this.taxonomyItem=null,this.taxonomyFields=[],this.search="",this.response={},this.responseOriginal={},this.allSelected=!1,this.selectedItems=[],await Promise.all([this.getPostType(),this.getPostTypeFields(),this.getTaxonomy(),this.getTaxonomyFields(),this.getItems()]),this.selectedItems=[],this.allSelected=!1},async getPostType(){const e=await this.apiFetch(`${this.apiBase}/api/v1/post-types/${this.slug}`);this.postType=await e.json()},async getPostTypeFields(){const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/fields`);this.postTypeFields=await e.json(),typeof this.postTypeFields?.sort=="function"&&(this.postTypeFields=this.postTypeFields.sort((s,o)=>s.field.order-o.field.order))},async getTaxonomy(){const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/taxonomies/${this.taxonomy}`);this.taxonomyItem=await e.json()},async getTaxonomyFields(){const e=await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/taxonomies/${this.taxonomy}/fields`);this.taxonomyFields=await e.json(),typeof this.taxonomyFields?.sort=="function"&&(this.taxonomyFields=this.taxonomyFields.sort((s,o)=>s.field.order-o.field.order))},async getItems(){const e=new URLSearchParams;this.offset<0&&(this.offset=0),this.tab==="trashed"&&e.set("trashed","true"),this.parent_id&&e.set("parent_id",this.parent_id),this.limit&&e.set("limit",this.limit),this.offset&&e.set("offset",this.offset),this.search&&e.set("search",this.search),this.searchable&&e.set("searchable",JSON.stringify(this.searchable)),this.orderBy&&e.set("orderBy",this.orderBy),this.sort&&e.set("sort",this.sort),this.tab==="published"&&e.set("status","published"),this.tab==="drafts"&&e.set("status","draft");const s=`${this.apiBase}/api/v1/${this.slug}/terms/${this.taxonomy}${e.toString()?"?"+e.toString():""}`,o=await this.apiFetch(s);this.response=await o.json(),this.responseOriginal=JSON.parse(JSON.stringify(this.response))},toggleAll(){this.allSelected=!this.allSelected,this.allSelected?this.selectedItems=this.response?.items?.map(e=>e.id)||[]:this.selectedItems=[]},toggleItem(e){const s=this.selectedItems.indexOf(e);s>-1?this.selectedItems.splice(s,1):this.selectedItems.push(e),this.allSelected=this.selectedItems.length===(this.response?.items?.length||0)},isSelected(e){return this.selectedItems.includes(e)},syncActionCellWidths(){this.$nextTick(()=>{const e=this.$el.querySelector(".body .row .actions-cell"),s=this.$el.querySelector(".header .actions-cell"),o=this.$el.querySelector(".footer .actions-cell");if(e&&s&&o){const h=e.offsetWidth+"px";s.style.width=h,o.style.width=h}})}}},P={key:1,class:"container"},D={class:"header-section"},M={class:"tabs-and-search"},j={class:"tabs"},J={class:"search"},L={class:"filters-and-navigation"},E={class:"filters"},W={class:"filters-section"},q={key:0,value:"trash"},z={key:1,value:"restore"},R={key:2,value:"delete"},H={value:"duplicate"},K={value:"save"},G=["disabled"],Q={class:"filters-section"},X={class:"navigation"},Y={class:"nav-text"},Z=["disabled"],x=["disabled"],$={class:"page-info"},ee=["disabled"],te=["disabled"],se={class:"table-wrapper"},le={class:"table"},ie={class:"header"},ae=["checked"],oe={class:"actions-cell sticky-left"},ne={class:"field"},re={class:"field"},de={key:0,class:"field"},he=["checked"],ue={class:"body"},ce=["onClick"],fe=["checked","onChange"],ge={class:"actions-cell sticky-left"},ye=["onClick"],pe=["onClick"],me=["onClick"],be=["disabled","onClick"],ve=["onUpdate:modelValue"],ke=["value"],Ce=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],we=["onUpdate:modelValue"],Se={key:6},Te={class:"field"},Ae=["value"],Fe={class:"field"},Oe=["value"],Be={key:0,class:"field"},Ue=["value"],Ve=["onClick"],Ne=["checked","onChange"],Pe={class:"footer"},De=["checked"],Me={class:"actions-cell sticky-left"},je={class:"field"},Je={class:"field"},Le={key:0,class:"field"},Ee=["checked"],We={class:"filters-and-navigation bottom-nav"},qe={class:"filters"},ze={class:"filters-section"},Re={key:0,value:"trash"},He={key:1,value:"restore"},Ke={key:2,value:"delete"},Ge={value:"duplicate"},Qe={value:"save"},Xe=["disabled"],Ye={class:"filters-section"},Ze={class:"navigation"},xe={class:"nav-text"},$e=["disabled"],et=["disabled"],tt={class:"page-info"},st=["disabled"],lt=["disabled"];function it(e,s,o,h,u,t){const w=B("router-link");return t.node?.vue_instance?(r(),d(y,{key:0},[o.sub&&t.navTree?(r(),m(k("drop-"+o.slug+"-"+o.sub),{key:0,slug:o.slug,sub:o.sub},null,8,["slug","sub"])):t.navTree?(r(),m(k("drop-"+o.slug),{key:1,slug:o.slug,sub:o.sub},null,8,["slug","sub"])):f("",!0)],64)):(r(),d("div",P,[l("div",D,[l("h1",null,a(t.node?.page_title),1),S(w,{class:"add-button",to:"/"+o.slug+"/terms/"+o.taxonomy+"/new"},{default:T(()=>[A(a(t.translate("Add"))+" "+a(t.translate(e.taxonomyItem?.name_singular)?.toLowerCase()),1)]),_:1},8,["to"]),(r(),m(U,{to:"body"},[e.mediaUploader?(r(),m(k(t.getControl("mediaselector")),{key:0,multi:!1,hideSelect:!0,postType:"attachments",onClose:s[0]||(s[0]=i=>{e.mediaUploader=!1,t.getItems()})},null,32)):f("",!0)]))]),l("div",M,[l("div",j,[l("button",{onClick:s[1]||(s[1]=i=>e.tab="all"),class:C([{active:e.tab==="all"},"tab-button"])},a(t.translate("All"))+" ("+a(e.response?.total||0)+")",3),l("button",{onClick:s[2]||(s[2]=i=>e.tab="published"),class:C([{active:e.tab==="published"},"tab-button"])},a(t.translate("Published"))+" ("+a(e.response?.total_published||0)+")",3),l("button",{onClick:s[3]||(s[3]=i=>e.tab="drafts"),class:C([{active:e.tab==="drafts"},"tab-button"])},a(t.translate("Drafts"))+" ("+a(e.response?.total_drafts||0)+")",3),l("button",{onClick:s[4]||(s[4]=i=>e.tab="trashed"),class:C([{active:e.tab==="trashed"},"tab-button"])},a(t.translate("Trashed"))+" ("+a(e.response?.total_trashed||0)+")",3)]),l("div",J,[g(l("input",{"onUpdate:modelValue":s[5]||(s[5]=i=>e.search=i),onKeypress:s[6]||(s[6]=V(i=>{e.offset=0,t.getItems()},["enter"]))},null,544),[[b,e.search]]),l("button",{onClick:s[7]||(s[7]=i=>{e.offset=0,t.getItems()}),class:"search-button"},a(t.translate("Search in"))+" "+a(t.translate(e.taxonomyItem?.name_plural)?.toLowerCase()),1)])]),l("div",L,[l("div",E,[l("div",W,[g(l("select",{"onUpdate:modelValue":s[8]||(s[8]=i=>e.action=i)},[l("option",null,a(t.translate("Bulk actions")),1),e.tab!=="trashed"?(r(),d("option",q,a(t.translate("Move to trash")),1)):f("",!0),e.tab==="trashed"?(r(),d("option",z,a(t.translate("Restore")),1)):f("",!0),e.tab==="trashed"?(r(),d("option",R,a(t.translate("Permanently delete")),1)):f("",!0),l("option",H,a(t.translate("Duplicate")),1),l("option",K,a(t.translate("Save")),1)],512),[[I,e.action]]),l("button",{disabled:!e.action,onClick:s[9]||(s[9]=i=>t.runBulk(e.action))},a(t.translate("Apply")),9,G)]),l("div",Q,[l("select",null,[l("option",null,a(t.translate("All dates")),1)]),l("select",null,[l("option",null,a(t.translate("All categories")),1)]),l("button",null,a(t.translate("Filter")),1)])]),l("div",X,[l("span",Y,a(e.response?.items?.length||0)+" "+a(t.translate("items")),1),l("button",{disabled:e.offset<=0,onClick:s[10]||(s[10]=i=>{e.offset=0,t.getItems()})},"«",8,Z),l("button",{disabled:e.offset<=0,onClick:s[11]||(s[11]=i=>{e.offset-=e.response?.limit,t.getItems()})},"‹",8,x),l("span",$,a(Math.floor(e.response?.offset/e.response?.limit)+1||0)+" "+a(t.translate("of"))+" "+a(Math.ceil(e.response?.total_current/e.response?.limit)||0),1),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[12]||(s[12]=i=>{e.offset+=e.response?.limit,t.getItems()})},"›",8,ee),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[13]||(s[13]=i=>{e.offset=(Math.ceil(e.response?.total_current/e.response?.limit)-1)*e.response?.limit,t.getItems()})},"»",8,te)])]),l("div",se,[l("div",le,[l("div",ie,[l("div",{onClick:s[16]||(s[16]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[14]||(s[14]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[15]||(s[15]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,ae)]),l("div",oe,a(t.translate("Actions")),1),(r(!0),d(y,null,v(e.taxonomyFields||[],({field:i,priority:n,source:_})=>(r(),d("div",{key:i.slug,class:"field"},a(t.translate(i.name)),1))),128)),l("div",ne,a(t.translate("Created at")),1),l("div",re,a(t.translate("Updated at")),1),e.tab==="trashed"?(r(),d("div",de,a(t.translate("Deleted at")),1)):f("",!0),l("div",{onClick:s[19]||(s[19]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[17]||(s[17]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[18]||(s[18]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,he)])]),l("div",ue,[(r(!0),d(y,null,v(e.response?.items||[],i=>(r(),d("div",{key:i.id,class:"row"},[l("div",{onClick:n=>t.toggleItem(i.id),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[20]||(s[20]=p(()=>{},["stop"])),type:"checkbox",checked:t.isSelected(i.id),onChange:n=>t.toggleItem(i.id)},null,40,fe)],8,ce),l("div",ge,[S(w,{class:"button",to:"/"+o.slug+"/terms/"+o.taxonomy+"/"+(e.taxonomyFields?.some(n=>n.field?.slug==="slug")?i.slug:i.id)},{default:T(()=>[A(a(t.translate("Open")),1)]),_:1},8,["to"]),e.tab==="trashed"?(r(),d("button",{key:0,class:"button",onClick:n=>t.restore(i)},a(t.translate("Restore")),9,ye)):f("",!0),e.tab!=="trashed"?(r(),d("button",{key:1,class:"button",onClick:n=>t.trash(i)},a(t.translate("Trash")),9,pe)):(r(),d("button",{key:2,class:"button",onClick:n=>t.trash(i,!0)},a(t.translate("Delete")),9,me)),l("button",{class:"button",disabled:!t.hasChanges(i),onClick:n=>t.save(i)},a(t.translate("Save")),9,be)]),(r(!0),d(y,null,v(e.taxonomyFields||[],({field:n,priority:_,source:F})=>(r(),d("div",{key:n.slug,class:"field"},[n.type==="select"?g((r(),d("select",{key:0,"onUpdate:modelValue":c=>i[n.slug]=c},[(r(!0),d(y,null,v(n.options?.choices,c=>(r(),d("option",{value:c},a(c),9,ke))),256))],8,ve)),[[I,i[n.slug]]]):n.type==="text"?g((r(),d("input",{key:1,"onUpdate:modelValue":c=>i[n.slug]=c},null,8,Ce)),[[b,i[n.slug]]]):n.type==="number"?g((r(),d("input",{key:2,type:"number","onUpdate:modelValue":c=>i[n.slug]=c},null,8,_e)),[[b,i[n.slug]]]):n.type==="textarea"?g((r(),d("textarea",{key:3,"onUpdate:modelValue":c=>i[n.slug]=c},null,8,Ie)),[[b,i[n.slug]]]):n.type==="editor"?g((r(),d("textarea",{key:4,"onUpdate:modelValue":c=>i[n.slug]=c},null,8,we)),[[b,i[n.slug]]]):t.controls?.find(c=>c.slug===n.type)?(r(),m(k(t.getControl(n.type)),{key:5,postType:o.slug,modelValue:i[n.slug],"onUpdate:modelValue":c=>i[n.slug]=c,field:n,priority:_,source:F,item:i},null,8,["postType","modelValue","onUpdate:modelValue","field","priority","source","item"])):(r(),d("div",Se,"Unsupported field: "+a(n),1))]))),128)),l("div",Te,[l("input",{readonly:"",value:i?.created_at},null,8,Ae)]),l("div",Fe,[l("input",{readonly:"",value:i?.updated_at},null,8,Oe)]),e.tab==="trashed"?(r(),d("div",Be,[l("input",{readonly:"",value:i?.deleted_at},null,8,Ue)])):f("",!0),l("div",{onClick:n=>t.toggleItem(i.id),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[21]||(s[21]=p(()=>{},["stop"])),type:"checkbox",checked:t.isSelected(i.id),onChange:n=>t.toggleItem(i.id)},null,40,Ne)],8,Ve)]))),128))]),l("div",Pe,[l("div",{onClick:s[24]||(s[24]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[22]||(s[22]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[23]||(s[23]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,De)]),l("div",Me,a(t.translate("Actions")),1),(r(!0),d(y,null,v(e.taxonomyFields||[],({field:i,priority:n,source:_})=>(r(),d("div",{key:i.slug,class:"field"},a(t.translate(i.name)),1))),128)),l("div",je,a(t.translate("Created at")),1),l("div",Je,a(t.translate("Updated at")),1),e.tab==="trashed"?(r(),d("div",Le,a(t.translate("Deleted at")),1)):f("",!0),l("div",{onClick:s[27]||(s[27]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[25]||(s[25]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[26]||(s[26]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,Ee)])])])]),l("div",We,[l("div",qe,[l("div",ze,[g(l("select",{"onUpdate:modelValue":s[28]||(s[28]=i=>e.action=i)},[l("option",null,a(t.translate("Bulk actions")),1),e.tab!=="trashed"?(r(),d("option",Re,a(t.translate("Move to trash")),1)):f("",!0),e.tab==="trashed"?(r(),d("option",He,a(t.translate("Restore")),1)):f("",!0),e.tab==="trashed"?(r(),d("option",Ke,a(t.translate("Permanently delete")),1)):f("",!0),l("option",Ge,a(t.translate("Duplicate")),1),l("option",Qe,a(t.translate("Save")),1)],512),[[I,e.action]]),l("button",{disabled:!e.action,onClick:s[29]||(s[29]=i=>t.runBulk(e.action))},a(t.translate("Apply")),9,Xe)]),l("div",Ye,[l("select",null,[l("option",null,a(t.translate("All dates")),1)]),l("select",null,[l("option",null,a(t.translate("All categories")),1)]),l("button",null,a(t.translate("Filter")),1)])]),l("div",Ze,[l("span",xe,a(e.response?.items?.length||0)+" "+a(t.translate("items")),1),l("button",{disabled:e.offset<=0,onClick:s[30]||(s[30]=i=>{e.offset=0,t.getItems()})},"«",8,$e),l("button",{disabled:e.offset<=0,onClick:s[31]||(s[31]=i=>{e.offset-=e.response?.limit,t.getItems()})},"‹",8,et),l("span",tt,a(Math.floor(e.response?.offset/e.response?.limit)+1||0)+" "+a(t.translate("of"))+" "+a(Math.ceil(e.response?.total_current/e.response?.limit)||0),1),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[32]||(s[32]=i=>{e.offset+=e.response?.limit,t.getItems()})},"›",8,st),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[33]||(s[33]=i=>{e.offset=(Math.ceil(e.response?.total_current/e.response?.limit)-1)*e.response?.limit,t.getItems()})},"»",8,lt)])])]))}const ot=O(N,[["render",it],["__scopeId","data-v-7970809c"]]);export{ot as default};
