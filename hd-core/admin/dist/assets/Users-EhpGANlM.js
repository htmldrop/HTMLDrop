import{_ as V,b as d,e as o,p as C,d as g,q as _,F as p,g as l,h as w,t as a,w as A,k as T,m as b,s as f,v,x as B,y as S,z as y,f as m,l as O}from"./index-BrXJsB32.js";const q={inject:["translate","apiBase","apiFetch","navTree","controls","getControl"],props:["sub"],data:()=>({slug:"users",action:"",postTypeFields:[],response:{},responseOriginal:{},allSelected:!1,selectedItems:[],tab:"all",offset:0,limit:10,search:"",searchable:null,orderBy:"",sort:""}),created(){this.init()},mounted(){this.syncActionCellWidths(),window.addEventListener("resize",this.syncActionCellWidths)},beforeUnmount(){window.removeEventListener("resize",this.syncActionCellWidths)},computed:{node(){const e=this.navTree?.find(s=>s.slug===this.slug);return this.sub&&e?.children?.find(s=>s.slug===this.sub)||e}},watch:{slug(){this.tab="all",this.init()},sub(){this.init()},response(e){this.$nextTick(()=>this.syncActionCellWidths())},tab(){this.init()}},methods:{hasChanges(e){const s=this.responseOriginal?.items.find(r=>r.id===e.id);return JSON.stringify(e)!==JSON.stringify(s)},getChanges(e){const s={},r=this.responseOriginal?.items.find(u=>u.id===e.id);for(const u of Object.keys(e))r?.[u]!==e[u]&&(s[u]=e[u]);return s},async runBulk(e){const s=this.response.items.filter(r=>this.selectedItems.includes(r.id));if(e==="trash")for(const r of s)this.trash(r);else if(e==="delete"){if(!confirm("Permanently delete all selected?"))return;for(const r of s)this.trash(r,!0,!0)}else if(e==="restore")for(const r of s)this.restore(r);else if(e==="save")for(const r of s)this.save(r);else if(e==="duplicate"){const r=[];for(const u of s){const c=JSON.parse(JSON.stringify(u));c.slug&&(c.slug+="-"+Date.now()),delete c.id,delete c.created_at,delete c.updated_at,r.push(this.create(c))}await Promise.all(r),this.getItems()}},async create(e){await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}`,{method:"POST",body:JSON.stringify(e)})},async save(e){const s=this.responseOriginal?.items.find(t=>t.id===e.id),r=s.status,c=await(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${e.id}`,{method:"PATCH",body:JSON.stringify(this.getChanges(e))})).json();for(const t of Object.keys(c))e[t]=c[t],s[t]=c[t];e.status!==r&&(e.status==="inactive"&&this.response.total_inactive++,e.status==="active"&&this.response.total_active++,r==="inactive"&&this.response.total_inactive--,r==="active"&&this.response.total_active--)},async trash(e,s=!1,r=!1){const c=(this.responseOriginal?.items.find(t=>t.id===e.id)).status;!r&&s&&!confirm("Delete permanently?")||(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${e.id}${s?"?permanently=true":""}`,{method:"DELETE"}),this.responseOriginal.items=this.responseOriginal.items.filter(t=>t.id!==e.id),this.response.items=this.response.items.filter(t=>t.id!==e.id),e.deleted_at?s&&this.response.total_trashed--:(c==="inactive"&&this.response.total_inactive--,c==="active"&&this.response.total_active--,this.response.total_trashed++),this.response.total--)},async restore(e){const r=(this.responseOriginal?.items.find(u=>u.id===e.id)).status;await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${e.id}`,{method:"PATCH",body:JSON.stringify({deleted_at:null})}),this.responseOriginal.items=this.responseOriginal.items.filter(u=>u.id!==e.id),this.response.items=this.response.items.filter(u=>u.id!==e.id),this.response.total_trashed--,this.response.total++,r==="inactive"&&this.response.total_inactive++,r==="active"&&this.response.total_active++},async init(){this.postTypeFields=[{field:{parent_slug:this.slug,name:"Username",slug:"username",type:"text",revisions:!1,required:!0,priority:10,order:1e3},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"First name",slug:"first_name",type:"text",revisions:!1,required:!1,priority:10,order:1100},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Middle name",slug:"middle_name",type:"text",revisions:!1,required:!1,priority:10,order:1200},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Last name",slug:"last_name",type:"text",revisions:!1,required:!1,priority:10,order:1300},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Email",slug:"email",type:"text",revisions:!1,required:!1,priority:10,order:1400},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Phone",slug:"phone",type:"text",revisions:!1,required:!1,priority:10,order:1500},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Locale",slug:"locale",type:"text",revisions:!1,required:!1,priority:10,order:1600},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Email verified at",slug:"email_verified_at",type:"text",revisions:!1,required:!1,priority:10,order:1700},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Phone verified at",slug:"phone_verified_at",type:"text",revisions:!1,required:!1,priority:10,order:1800},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Status",slug:"status",options:{choices:["active","inactive"]},type:"select",revisions:!1,required:!1,priority:10,order:1900},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Picture",slug:"picture",type:"media",revisions:!1,required:!1,priority:10,order:2e3},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Password",slug:"password",type:"password",revisions:!1,required:!1,priority:10,order:2e3},priority:10,source:"runtime"}],this.search="",this.response={},this.responseOriginal={},this.allSelected=!1,this.selectedItems=[],await Promise.all([this.getItems()]),this.selectedItems=[],this.allSelected=!1},async getItems(){const e=new URLSearchParams;this.offset<0&&(this.offset=0),this.tab==="trashed"&&e.set("trashed","true"),this.limit&&e.set("limit",this.limit),this.offset&&e.set("offset",this.offset),this.search&&e.set("search",this.search),this.searchable&&e.set("searchable",JSON.stringify(this.searchable)),this.orderBy&&e.set("orderBy",this.orderBy),this.sort&&e.set("sort",this.sort),this.tab==="active"&&e.set("status","active"),this.tab==="inactive"&&e.set("status","inactive");const s=`${this.apiBase}/api/v1/${this.slug}${e.toString()?"?"+e.toString():""}`,r=await this.apiFetch(s);this.response=await r.json(),this.responseOriginal=JSON.parse(JSON.stringify(this.response))},toggleAll(){this.allSelected=!this.allSelected,this.allSelected?this.selectedItems=this.response?.items?.map(e=>e.id)||[]:this.selectedItems=[]},toggleItem(e){const s=this.selectedItems.indexOf(e);s>-1?this.selectedItems.splice(s,1):this.selectedItems.push(e),this.allSelected=this.selectedItems.length===(this.response?.items?.length||0)},isSelected(e){return this.selectedItems.includes(e)},syncActionCellWidths(){this.$nextTick(()=>{if(typeof this.$el?.querySelector!="function")return;const e=this.$el.querySelector(".body .row .actions-cell"),s=this.$el.querySelector(".header .actions-cell"),r=this.$el.querySelector(".footer .actions-cell");if(e&&s&&r){const u=e.offsetWidth+"px";s.style.width=u,r.style.width=u}})}}},F={key:1,class:"container"},N={class:"header-section"},P={class:"tabs-and-search"},M={class:"tabs"},D={class:"search"},J={class:"filters-and-navigation"},L={class:"filters"},E={class:"filters-section"},j={key:0,value:"trash"},W={key:1,value:"restore"},z={key:2,value:"delete"},R={value:"duplicate"},H={value:"save"},K=["disabled"],G={class:"filters-section"},Q={class:"navigation"},X={class:"nav-text"},Y=["disabled"],Z=["disabled"],$={class:"page-info"},x=["disabled"],ee=["disabled"],te={class:"table-wrapper"},se={class:"table"},le={class:"header"},ie=["checked"],ae={class:"actions-cell sticky-left"},ne={class:"field"},re={class:"field"},oe={key:0,class:"field"},de=["checked"],ue={class:"body"},he=["onClick"],ce=["checked","onChange"],ge={class:"actions-cell sticky-left"},fe=["onClick"],pe=["onClick"],ve=["onClick"],ye=["disabled","onClick"],me=["onUpdate:modelValue"],be=["value"],ke=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],Se=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],we={key:7},Ae={class:"field"},Oe=["value"],Ue={class:"field"},Ve=["value"],Te={key:0,class:"field"},Be=["value"],qe=["onClick"],Fe=["checked","onChange"],Ne={class:"footer"},Pe=["checked"],Me={class:"actions-cell sticky-left"},De={class:"field"},Je={class:"field"},Le={key:0,class:"field"},Ee=["checked"],je={class:"filters-and-navigation bottom-nav"},We={class:"filters"},ze={class:"filters-section"},Re={key:0,value:"trash"},He={key:1,value:"restore"},Ke={key:2,value:"delete"},Ge={value:"duplicate"},Qe={value:"save"},Xe=["disabled"],Ye={class:"filters-section"},Ze={class:"navigation"},$e={class:"nav-text"},xe=["disabled"],et=["disabled"],tt={class:"page-info"},st=["disabled"],lt=["disabled"];function it(e,s,r,u,c,t){const I=T("router-link");return t.node?.vue_instance?(o(),d(p,{key:0},[r.sub&&t.navTree?(o(),C(_("drop-"+e.slug+"-"+r.sub),{key:0,slug:e.slug,sub:r.sub},null,8,["slug","sub"])):t.navTree?(o(),C(_("drop-"+e.slug),{key:1,slug:e.slug,sub:r.sub},null,8,["slug","sub"])):g("",!0)],64)):(o(),d("div",F,[l("div",N,[l("h1",null,a(t.node?.page_title),1),w(I,{class:"add-button",to:"/"+e.slug+"/new"},{default:A(()=>[O(a(t.translate("Add"))+" "+a(t.translate("User")?.toLowerCase()),1)]),_:1},8,["to"])]),l("div",P,[l("div",M,[l("button",{onClick:s[0]||(s[0]=i=>e.tab="all"),class:b([{active:e.tab==="all"},"tab-button"])},a(t.translate("All"))+" ("+a(e.response?.total)+")",3),l("button",{onClick:s[1]||(s[1]=i=>e.tab="active"),class:b([{active:e.tab==="active"},"tab-button"])},a(t.translate("Active"))+" ("+a(e.response?.total_active||0)+")",3),l("button",{onClick:s[2]||(s[2]=i=>e.tab="inactive"),class:b([{active:e.tab==="inactive"},"tab-button"])},a(t.translate("Inactive"))+" ("+a(e.response?.total_inactive||0)+")",3),l("button",{onClick:s[3]||(s[3]=i=>e.tab="trashed"),class:b([{active:e.tab==="trashed"},"tab-button"])},a(t.translate("Trashed"))+" ("+a(e.response?.total_trashed||0)+")",3)]),l("div",D,[f(l("input",{"onUpdate:modelValue":s[4]||(s[4]=i=>e.search=i),onKeypress:s[5]||(s[5]=B(i=>{e.offset=0,t.getItems()},["enter"]))},null,544),[[v,e.search]]),l("button",{onClick:s[6]||(s[6]=i=>{e.offset=0,t.getItems()}),class:"search-button"},a(t.translate("Search in"))+" "+a(t.translate("Users")?.toLowerCase()),1)])]),l("div",J,[l("div",L,[l("div",E,[f(l("select",{"onUpdate:modelValue":s[7]||(s[7]=i=>e.action=i)},[l("option",null,a(t.translate("Bulk actions")),1),e.tab!=="trashed"?(o(),d("option",j,a(t.translate("Move to trash")),1)):g("",!0),e.tab==="trashed"?(o(),d("option",W,a(t.translate("Restore")),1)):g("",!0),e.tab==="trashed"?(o(),d("option",z,a(t.translate("Permanently delete")),1)):g("",!0),l("option",R,a(t.translate("Duplicate")),1),l("option",H,a(t.translate("Save")),1)],512),[[S,e.action]]),l("button",{disabled:!e.action,onClick:s[8]||(s[8]=i=>t.runBulk(e.action))},a(t.translate("Apply")),9,K)]),l("div",G,[l("select",null,[l("option",null,a(t.translate("All dates")),1)]),l("select",null,[l("option",null,a(t.translate("All categories")),1)]),l("button",null,a(t.translate("Filter")),1)])]),l("div",Q,[l("span",X,a(e.response?.items?.length||0)+" "+a(t.translate("items")),1),l("button",{disabled:e.offset<=0,onClick:s[9]||(s[9]=i=>{e.offset=0,t.getItems()})},"«",8,Y),l("button",{disabled:e.offset<=0,onClick:s[10]||(s[10]=i=>{e.offset-=e.response?.limit,t.getItems()})},"‹",8,Z),l("span",$,a(Math.floor(e.response?.offset/e.response?.limit)+1||0)+" "+a(t.translate("of"))+" "+a(Math.ceil(e.response?.total_current/e.response?.limit)||0),1),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[11]||(s[11]=i=>{e.offset+=e.response?.limit,t.getItems()})},"›",8,x),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[12]||(s[12]=i=>{e.offset=(Math.ceil(e.response?.total_current/e.response?.limit)-1)*e.response?.limit,t.getItems()})},"»",8,ee)])]),l("div",te,[l("div",se,[l("div",le,[l("div",{onClick:s[15]||(s[15]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[13]||(s[13]=y(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[14]||(s[14]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,ie)]),l("div",ae,a(t.translate("Actions")),1),(o(!0),d(p,null,m(e.postTypeFields||[],({field:i,priority:n,source:k})=>(o(),d("div",{key:i.slug,class:"field"},a(t.translate(i.name)),1))),128)),l("div",ne,a(t.translate("Created at")),1),l("div",re,a(t.translate("Updated at")),1),e.tab==="trashed"?(o(),d("div",oe,a(t.translate("Deleted at")),1)):g("",!0),l("div",{onClick:s[18]||(s[18]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[16]||(s[16]=y(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[17]||(s[17]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,de)])]),l("div",ue,[(o(!0),d(p,null,m(e.response?.items||[],i=>(o(),d("div",{key:i.id,class:"row"},[l("div",{onClick:n=>t.toggleItem(i.id),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[19]||(s[19]=y(()=>{},["stop"])),type:"checkbox",checked:t.isSelected(i.id),onChange:n=>t.toggleItem(i.id)},null,40,ce)],8,he),l("div",ge,[w(I,{class:"button",to:"/"+e.slug+"/"+(e.postTypeFields?.some(n=>n.field?.slug==="slug")?i.slug:i.id)},{default:A(()=>[O(a(t.translate("Open")),1)]),_:1},8,["to"]),e.tab==="trashed"?(o(),d("button",{key:0,class:"button",onClick:n=>t.restore(i)},a(t.translate("Restore")),9,fe)):g("",!0),e.tab!=="trashed"?(o(),d("button",{key:1,class:"button",onClick:n=>t.trash(i)},a(t.translate("Trash")),9,pe)):(o(),d("button",{key:2,class:"button",onClick:n=>t.trash(i,!0)},a(t.translate("Delete")),9,ve)),l("button",{class:"button",disabled:!t.hasChanges(i),onClick:n=>t.save(i)},a(t.translate("Save")),9,ye)]),(o(!0),d(p,null,m(e.postTypeFields||[],({field:n,priority:k,source:U})=>(o(),d("div",{key:n.slug,class:"field"},[n.type==="select"?f((o(),d("select",{key:0,"onUpdate:modelValue":h=>i[n.slug]=h},[(o(!0),d(p,null,m(n.options?.choices,h=>(o(),d("option",{value:h},a(h),9,be))),256))],8,me)),[[S,i[n.slug]]]):n.type==="text"?f((o(),d("input",{key:1,"onUpdate:modelValue":h=>i[n.slug]=h},null,8,ke)),[[v,i[n.slug]]]):n.type==="number"?f((o(),d("input",{key:2,type:"number","onUpdate:modelValue":h=>i[n.slug]=h},null,8,Ce)),[[v,i[n.slug]]]):n.type==="password"?f((o(),d("input",{key:3,type:"password","onUpdate:modelValue":h=>i[n.slug]=h},null,8,_e)),[[v,i[n.slug]]]):n.type==="textarea"?f((o(),d("textarea",{key:4,"onUpdate:modelValue":h=>i[n.slug]=h},null,8,Se)),[[v,i[n.slug]]]):n.type==="editor"?f((o(),d("textarea",{key:5,"onUpdate:modelValue":h=>i[n.slug]=h},null,8,Ie)),[[v,i[n.slug]]]):t.controls?.find(h=>h.slug===n.type)?(o(),C(_(t.getControl(n.type)),{key:6,postType:e.slug,modelValue:i[n.slug],"onUpdate:modelValue":h=>i[n.slug]=h,field:n,priority:k,source:U,item:i},null,8,["postType","modelValue","onUpdate:modelValue","field","priority","source","item"])):(o(),d("div",we,"Unsupported field: "+a(n),1))]))),128)),l("div",Ae,[l("input",{readonly:"",value:i?.created_at},null,8,Oe)]),l("div",Ue,[l("input",{readonly:"",value:i?.updated_at},null,8,Ve)]),e.tab==="trashed"?(o(),d("div",Te,[l("input",{readonly:"",value:i?.deleted_at},null,8,Be)])):g("",!0),l("div",{onClick:n=>t.toggleItem(i.id),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[20]||(s[20]=y(()=>{},["stop"])),type:"checkbox",checked:t.isSelected(i.id),onChange:n=>t.toggleItem(i.id)},null,40,Fe)],8,qe)]))),128))]),l("div",Ne,[l("div",{onClick:s[23]||(s[23]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[21]||(s[21]=y(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[22]||(s[22]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,Pe)]),l("div",Me,a(t.translate("Actions")),1),(o(!0),d(p,null,m(e.postTypeFields||[],({field:i,priority:n,source:k})=>(o(),d("div",{key:i.slug,class:"field"},a(t.translate(i.name)),1))),128)),l("div",De,a(t.translate("Created at")),1),l("div",Je,a(t.translate("Updated at")),1),e.tab==="trashed"?(o(),d("div",Le,a(t.translate("Deleted at")),1)):g("",!0),l("div",{onClick:s[26]||(s[26]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[24]||(s[24]=y(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[25]||(s[25]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,Ee)])])])]),l("div",je,[l("div",We,[l("div",ze,[f(l("select",{"onUpdate:modelValue":s[27]||(s[27]=i=>e.action=i)},[l("option",null,a(t.translate("Bulk actions")),1),e.tab!=="trashed"?(o(),d("option",Re,a(t.translate("Move to trash")),1)):g("",!0),e.tab==="trashed"?(o(),d("option",He,a(t.translate("Restore")),1)):g("",!0),e.tab==="trashed"?(o(),d("option",Ke,a(t.translate("Permanently delete")),1)):g("",!0),l("option",Ge,a(t.translate("Duplicate")),1),l("option",Qe,a(t.translate("Save")),1)],512),[[S,e.action]]),l("button",{disabled:!e.action,onClick:s[28]||(s[28]=i=>t.runBulk(e.action))},a(t.translate("Apply")),9,Xe)]),l("div",Ye,[l("select",null,[l("option",null,a(t.translate("All dates")),1)]),l("select",null,[l("option",null,a(t.translate("All categories")),1)]),l("button",null,a(t.translate("Filter")),1)])]),l("div",Ze,[l("span",$e,a(e.response?.items?.length||0)+" "+a(t.translate("items")),1),l("button",{disabled:e.offset<=0,onClick:s[29]||(s[29]=i=>{e.offset=0,t.getItems()})},"«",8,xe),l("button",{disabled:e.offset<=0,onClick:s[30]||(s[30]=i=>{e.offset-=e.response?.limit,t.getItems()})},"‹",8,et),l("span",tt,a(Math.floor(e.response?.offset/e.response?.limit)+1||0)+" "+a(t.translate("of"))+" "+a(Math.ceil(e.response?.total_current/e.response?.limit)||0),1),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[31]||(s[31]=i=>{e.offset+=e.response?.limit,t.getItems()})},"›",8,st),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[32]||(s[32]=i=>{e.offset=(Math.ceil(e.response?.total_current/e.response?.limit)-1)*e.response?.limit,t.getItems()})},"»",8,lt)])])]))}const nt=V(q,[["render",it],["__scopeId","data-v-bf832cb2"]]);export{nt as default};
