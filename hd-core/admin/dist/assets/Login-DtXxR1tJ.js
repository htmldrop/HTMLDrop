import{W as y}from"./wizard-DWPtMIpE.js";import{_ as f,p as k,e as o,w as P,k as M,b as i,d as n,F as w,g as r,s as d,v as l,z as p,t as h,m}from"./index-BrXJsB32.js";import"./Logo-Djfm86QI.js";const T={inject:["apiBase","apiFetch","reloadUser"],components:{Wizard:y},data:()=>({email:"",password:"",health:{},error:!1,showResetForm:!1,showResetPasswordForm:!1,resetEmail:"",resetMessage:"",resetMessageType:"",isLoading:!1,newPassword:"",confirmPassword:"",resetToken:""}),async created(){this.health=await this.getHealth();const e=new URLSearchParams(window.location.search).get("token");e&&(this.resetToken=e,await this.validateResetToken(e))},methods:{async getHealth(){return(await fetch(`${this.apiBase}/api/v1/health`)).json()},async submit(){const s=await fetch(`${this.apiBase}/api/v1/auth/login`,{method:"POST",body:JSON.stringify({email:this.email,password:this.password})});if(s.ok){const e=await s.json();localStorage.setItem("tokens",JSON.stringify(e)),this.reloadUser(),this.$router.push("/")}else this.error=!0},async requestPasswordReset(){if(!this.resetEmail){this.resetMessage="Please enter your email address",this.resetMessageType="error";return}this.isLoading=!0,this.resetMessage="";try{const s=await fetch(`${this.apiBase}/api/v1/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.resetEmail})}),e=await s.json();s.ok?(this.resetMessage=e.message||"Password reset link sent! Check your email.",this.resetMessageType="success"):(this.resetMessage=e.message||"Failed to send reset link",this.resetMessageType="error")}catch{this.resetMessage="An error occurred. Please try again.",this.resetMessageType="error"}finally{this.isLoading=!1}},async validateResetToken(s){try{(await(await fetch(`${this.apiBase}/api/v1/auth/validate-reset-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s})})).json()).valid?(this.showResetPasswordForm=!0,this.showResetForm=!1):(this.resetMessage="This password reset link is invalid or has expired.",this.resetMessageType="error",this.showResetForm=!0)}catch{this.resetMessage="Invalid or expired reset link",this.resetMessageType="error",this.showResetForm=!0}},async resetPassword(){if(!this.newPassword||!this.confirmPassword){this.resetMessage="Please fill in all fields",this.resetMessageType="error";return}if(this.newPassword!==this.confirmPassword){this.resetMessage="Passwords do not match",this.resetMessageType="error";return}this.isLoading=!0,this.resetMessage="";try{const s=await fetch(`${this.apiBase}/api/v1/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:this.resetToken,password:this.newPassword})}),e=await s.json();s.ok?(this.resetMessage="Password reset successfully! Redirecting to login...",this.resetMessageType="success",setTimeout(()=>{this.backToLogin()},2e3)):(this.resetMessage=e.message||"Failed to reset password",this.resetMessageType="error")}catch{this.resetMessage="An error occurred. Please try again.",this.resetMessageType="error"}finally{this.isLoading=!1}},resetResetForm(){this.showResetForm=!1,this.resetEmail="",this.resetMessage="",this.resetMessageType=""},backToLogin(){this.showResetForm=!1,this.showResetPasswordForm=!1,this.resetEmail="",this.newPassword="",this.confirmPassword="",this.resetMessage="",this.resetMessageType="",this.resetToken="",window.history.replaceState({},document.title,window.location.pathname)}}},R={key:0,class:"error-message"},c={class:"forgot-password-link"},v=["disabled"],F={class:"back-to-login"},b=["disabled"],L={class:"back-to-login"};function C(s,e,g,S,B,a){const u=M("Wizard");return o(),k(u,{steps:[],maxWidth:"400px"},{default:P(()=>[!s.showResetForm&&!s.showResetPasswordForm?(o(),i(w,{key:0},[e[11]||(e[11]=r("h1",null,"Login",-1)),d(r("input",{placeholder:"Email","onUpdate:modelValue":e[0]||(e[0]=t=>s.email=t)},null,512),[[l,s.email]]),d(r("input",{placeholder:"Password",type:"password","onUpdate:modelValue":e[1]||(e[1]=t=>s.password=t)},null,512),[[l,s.password]]),r("button",{onClick:e[2]||(e[2]=(...t)=>a.submit&&a.submit(...t))},"Login"),s.error?(o(),i("div",R," Invalid credentials ")):n("",!0),r("div",c,[r("a",{href:"#",onClick:e[3]||(e[3]=p(t=>s.showResetForm=!0,["prevent"]))},"Forgot your password?")])],64)):n("",!0),s.showResetForm&&!s.showResetPasswordForm?(o(),i(w,{key:1},[e[12]||(e[12]=r("h1",null,"Reset Password",-1)),e[13]||(e[13]=r("p",{class:"reset-description"},"Enter your email address and we'll send you a link to reset your password.",-1)),d(r("input",{placeholder:"Email","onUpdate:modelValue":e[4]||(e[4]=t=>s.resetEmail=t)},null,512),[[l,s.resetEmail]]),r("button",{onClick:e[5]||(e[5]=(...t)=>a.requestPasswordReset&&a.requestPasswordReset(...t)),disabled:s.isLoading},h(s.isLoading?"Sending...":"Send Reset Link"),9,v),s.resetMessage?(o(),i("div",{key:0,class:m(["message",s.resetMessageType])},h(s.resetMessage),3)):n("",!0),r("div",F,[r("a",{href:"#",onClick:e[6]||(e[6]=p((...t)=>a.resetResetForm&&a.resetResetForm(...t),["prevent"]))},"Back to login")])],64)):n("",!0),s.showResetPasswordForm?(o(),i(w,{key:2},[e[14]||(e[14]=r("h1",null,"Create New Password",-1)),e[15]||(e[15]=r("p",{class:"reset-description"},"Enter your new password below.",-1)),d(r("input",{placeholder:"New Password",type:"password","onUpdate:modelValue":e[7]||(e[7]=t=>s.newPassword=t)},null,512),[[l,s.newPassword]]),d(r("input",{placeholder:"Confirm Password",type:"password","onUpdate:modelValue":e[8]||(e[8]=t=>s.confirmPassword=t)},null,512),[[l,s.confirmPassword]]),r("button",{onClick:e[9]||(e[9]=(...t)=>a.resetPassword&&a.resetPassword(...t)),disabled:s.isLoading},h(s.isLoading?"Resetting...":"Reset Password"),9,b),s.resetMessage?(o(),i("div",{key:0,class:m(["message",s.resetMessageType])},h(s.resetMessage),3)):n("",!0),r("div",L,[r("a",{href:"#",onClick:e[10]||(e[10]=p((...t)=>a.backToLogin&&a.backToLogin(...t),["prevent"]))},"Back to login")])],64)):n("",!0)]),_:1})}const O=f(T,[["render",C],["__scopeId","data-v-8c83e7f0"]]);export{O as default};
