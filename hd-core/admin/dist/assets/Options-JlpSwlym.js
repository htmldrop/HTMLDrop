import{_ as V,b as d,e as r,p as m,d as v,q as C,F as f,g as l,h as I,t as n,w as A,k as T,m as U,s as g,v as y,x as B,y as _,z as p,f as b,l as w}from"./index-D7Qzma7X.js";const F={inject:["translate","apiBase","apiFetch","navTree","controls","getControl"],props:["sub"],data:()=>({slug:"options",action:"",postTypeFields:[],response:{},responseOriginal:{},allSelected:!1,selectedItems:[],tab:"all",offset:0,limit:10,search:"",searchable:null,orderBy:"",sort:""}),created(){this.init()},mounted(){this.syncActionCellWidths(),window.addEventListener("resize",this.syncActionCellWidths)},beforeUnmount(){window.removeEventListener("resize",this.syncActionCellWidths)},computed:{node(){const e=this.navTree?.find(s=>s.slug===this.slug);return this.sub&&e?.children?.find(s=>s.slug===this.sub)||e}},watch:{slug(){this.tab="all",this.init()},sub(){this.init()},response(e){this.$nextTick(()=>this.syncActionCellWidths())},tab(){this.init()}},methods:{hasChanges(e){const s=this.responseOriginal?.items.find(a=>a.id===e.id);return JSON.stringify(e)!==JSON.stringify(s)},getChanges(e){const s={},a=this.responseOriginal?.items.find(u=>u.id===e.id);for(const u of Object.keys(e))a?.[u]!==e[u]&&(s[u]=e[u]);return s},async runBulk(e){const s=this.response.items.filter(a=>this.selectedItems.includes(a.id));if(e==="trash")for(const a of s)this.trash(a);else if(e==="delete"){if(!confirm("Permanently delete all selected?"))return;for(const a of s)this.trash(a,!0,!0)}else if(e==="restore")for(const a of s)this.restore(a);else if(e==="save")for(const a of s)this.save(a);else if(e==="duplicate"){const a=[];for(const u of s){const h=JSON.parse(JSON.stringify(u));h.slug&&(h.slug+="-"+Date.now()),delete h.id,delete h.created_at,delete h.updated_at,a.push(this.create(h))}await Promise.all(a),this.getItems()}},async create(e){await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}`,{method:"POST",body:JSON.stringify(e)})},async save(e){const s=this.responseOriginal?.items.find(t=>t.id===e.id),a=s.status,h=await(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${e.id}`,{method:"PATCH",body:JSON.stringify(this.getChanges(e))})).json();for(const t of Object.keys(h))e[t]=h[t],s[t]=h[t];e.status!==a&&(e.status==="inactive"&&this.response.total_inactive++,e.status==="active"&&this.response.total_active++,a==="inactive"&&this.response.total_inactive--,a==="active"&&this.response.total_active--)},async trash(e,s=!1,a=!1){const h=(this.responseOriginal?.items.find(t=>t.id===e.id)).status;!a&&s&&!confirm("Delete permanently?")||(await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${e.id}${s?"?permanently=true":""}`,{method:"DELETE"}),this.responseOriginal.items=this.responseOriginal.items.filter(t=>t.id!==e.id),this.response.items=this.response.items.filter(t=>t.id!==e.id),e.deleted_at?s&&this.response.total_trashed--:(h==="inactive"&&this.response.total_inactive--,h==="active"&&this.response.total_active--,this.response.total_trashed++),this.response.total--)},async restore(e){const a=(this.responseOriginal?.items.find(u=>u.id===e.id)).status;await this.apiFetch(`${this.apiBase}/api/v1/${this.slug}/${e.id}`,{method:"PATCH",body:JSON.stringify({deleted_at:null})}),this.responseOriginal.items=this.responseOriginal.items.filter(u=>u.id!==e.id),this.response.items=this.response.items.filter(u=>u.id!==e.id),this.response.total_trashed--,this.response.total++,a==="inactive"&&this.response.total_inactive++,a==="active"&&this.response.total_active++},async init(){this.postTypeFields=[{field:{parent_slug:this.slug,name:"Name",slug:"name",type:"text",revisions:!1,required:!0,priority:10,order:1e3},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Value",slug:"value",type:"text",revisions:!1,required:!1,priority:10,order:1100},priority:10,source:"runtime"},{field:{parent_slug:this.slug,name:"Auto load",slug:"autoload",type:"boolean",revisions:!1,required:!1,priority:10,order:1200},priority:10,source:"runtime"}],this.search="",this.response={},this.responseOriginal={},this.allSelected=!1,this.selectedItems=[],await Promise.all([this.getItems()]),this.selectedItems=[],this.allSelected=!1},async getItems(){const e=new URLSearchParams;this.offset<0&&(this.offset=0),this.tab==="trashed"&&e.set("trashed","true"),this.limit&&e.set("limit",this.limit),this.offset&&e.set("offset",this.offset),this.search&&e.set("search",this.search),this.searchable&&e.set("searchable",JSON.stringify(this.searchable)),this.orderBy&&e.set("orderBy",this.orderBy),this.sort&&e.set("sort",this.sort),this.tab==="active"&&e.set("status","active"),this.tab==="inactive"&&e.set("status","inactive");const s=`${this.apiBase}/api/v1/${this.slug}${e.toString()?"?"+e.toString():""}`,a=await this.apiFetch(s);this.response=await a.json(),this.responseOriginal=JSON.parse(JSON.stringify(this.response))},toggleAll(){this.allSelected=!this.allSelected,this.allSelected?this.selectedItems=this.response?.items?.map(e=>e.id)||[]:this.selectedItems=[]},toggleItem(e){const s=this.selectedItems.indexOf(e);s>-1?this.selectedItems.splice(s,1):this.selectedItems.push(e),this.allSelected=this.selectedItems.length===(this.response?.items?.length||0)},isSelected(e){return this.selectedItems.includes(e)},syncActionCellWidths(){this.$nextTick(()=>{if(typeof this.$el?.querySelector!="function")return;const e=this.$el.querySelector(".body .row .actions-cell"),s=this.$el.querySelector(".header .actions-cell"),a=this.$el.querySelector(".footer .actions-cell");if(e&&s&&a){const u=e.offsetWidth+"px";s.style.width=u,a.style.width=u}})}}},N={key:1,class:"container"},D={class:"header-section"},J={class:"tabs-and-search"},M={class:"tabs"},P={class:"search"},q={class:"filters-and-navigation"},L={class:"filters"},j={class:"filters-section"},E={value:"delete"},W={value:"duplicate"},z={value:"save"},H=["disabled"],K={class:"filters-section"},R={class:"navigation"},G={class:"nav-text"},Q=["disabled"],X=["disabled"],Y={class:"page-info"},Z=["disabled"],$=["disabled"],x={class:"table-wrapper"},ee={class:"table"},te={class:"header"},se=["checked"],le={class:"actions-cell sticky-left"},ie={class:"field"},ne={class:"field"},ae={key:0,class:"field"},oe=["checked"],re={class:"body"},de=["onClick"],ue=["checked","onChange"],ce={class:"actions-cell sticky-left"},he=["onClick"],ge=["onClick"],fe=["onClick"],pe=["disabled","onClick"],ve=["onUpdate:modelValue"],ye=["value"],be=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],me=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],_e={key:6},Se={class:"field"},Ie=["value"],Ae={class:"field"},we=["value"],Oe={key:0,class:"field"},Ve=["value"],Te=["onClick"],Ue=["checked","onChange"],Be={class:"footer"},Fe=["checked"],Ne={class:"actions-cell sticky-left"},De={class:"field"},Je={class:"field"},Me={key:0,class:"field"},Pe=["checked"],qe={class:"filters-and-navigation bottom-nav"},Le={class:"filters"},je={class:"filters-section"},Ee={value:"delete"},We={value:"duplicate"},ze={value:"save"},He=["disabled"],Ke={class:"filters-section"},Re={class:"navigation"},Ge={class:"nav-text"},Qe=["disabled"],Xe=["disabled"],Ye={class:"page-info"},Ze=["disabled"],$e=["disabled"];function xe(e,s,a,u,h,t){const S=T("router-link");return t.node?.vue_instance?(r(),d(f,{key:0},[a.sub&&t.navTree?(r(),m(C("drop-"+e.slug+"-"+a.sub),{key:0,slug:e.slug,sub:a.sub},null,8,["slug","sub"])):t.navTree?(r(),m(C("drop-"+e.slug),{key:1,slug:e.slug,sub:a.sub},null,8,["slug","sub"])):v("",!0)],64)):(r(),d("div",N,[l("div",D,[l("h1",null,n(t.translate("Settings")),1),I(S,{class:"add-button",to:"/settings/new"},{default:A(()=>[w(n(t.translate("Add"))+" "+n(t.translate("setting")?.toLowerCase()),1)]),_:1})]),l("div",J,[l("div",M,[l("button",{onClick:s[0]||(s[0]=i=>e.tab="all"),class:U([{active:e.tab==="all"},"tab-button"])},n(t.translate("All"))+" ("+n(e.response?.total)+")",3)]),l("div",P,[g(l("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>e.search=i),onKeypress:s[2]||(s[2]=B(i=>{e.offset=0,t.getItems()},["enter"]))},null,544),[[y,e.search]]),l("button",{onClick:s[3]||(s[3]=i=>{e.offset=0,t.getItems()}),class:"search-button"},n(t.translate("Search in"))+" "+n(t.translate("Users")?.toLowerCase()),1)])]),l("div",q,[l("div",L,[l("div",j,[g(l("select",{"onUpdate:modelValue":s[4]||(s[4]=i=>e.action=i)},[l("option",null,n(t.translate("Bulk actions")),1),l("option",E,n(t.translate("Permanently delete")),1),l("option",W,n(t.translate("Duplicate")),1),l("option",z,n(t.translate("Save")),1)],512),[[_,e.action]]),l("button",{disabled:!e.action,onClick:s[5]||(s[5]=i=>t.runBulk(e.action))},n(t.translate("Apply")),9,H)]),l("div",K,[l("select",null,[l("option",null,n(t.translate("All dates")),1)]),l("select",null,[l("option",null,n(t.translate("All categories")),1)]),l("button",null,n(t.translate("Filter")),1)])]),l("div",R,[l("span",G,n(e.response?.items?.length||0)+" "+n(t.translate("items")),1),l("button",{disabled:e.offset<=0,onClick:s[6]||(s[6]=i=>{e.offset=0,t.getItems()})},"«",8,Q),l("button",{disabled:e.offset<=0,onClick:s[7]||(s[7]=i=>{e.offset-=e.response?.limit,t.getItems()})},"‹",8,X),l("span",Y,n(Math.floor(e.response?.offset/e.response?.limit)+1||0)+" "+n(t.translate("of"))+" "+n(Math.ceil(e.response?.total_current/e.response?.limit)||0),1),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[8]||(s[8]=i=>{e.offset+=e.response?.limit,t.getItems()})},"›",8,Z),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[9]||(s[9]=i=>{e.offset=(Math.ceil(e.response?.total_current/e.response?.limit)-1)*e.response?.limit,t.getItems()})},"»",8,$)])]),l("div",x,[l("div",ee,[l("div",te,[l("div",{onClick:s[12]||(s[12]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[10]||(s[10]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[11]||(s[11]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,se)]),l("div",le,n(t.translate("Actions")),1),(r(!0),d(f,null,b(e.postTypeFields||[],({field:i,priority:o,source:k})=>(r(),d("div",{key:i.slug,class:"field"},n(t.translate(i.name)),1))),128)),l("div",ie,n(t.translate("Created at")),1),l("div",ne,n(t.translate("Updated at")),1),e.tab==="trashed"?(r(),d("div",ae,n(t.translate("Deleted at")),1)):v("",!0),l("div",{onClick:s[15]||(s[15]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[13]||(s[13]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[14]||(s[14]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,oe)])]),l("div",re,[(r(!0),d(f,null,b(e.response?.items||[],i=>(r(),d("div",{key:i.id,class:"row"},[l("div",{onClick:o=>t.toggleItem(i.id),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[16]||(s[16]=p(()=>{},["stop"])),type:"checkbox",checked:t.isSelected(i.id),onChange:o=>t.toggleItem(i.id)},null,40,ue)],8,de),l("div",ce,[I(S,{class:"button",to:"/settings/"+(e.postTypeFields?.some(o=>o.field?.slug==="slug")?i.slug:i.id)},{default:A(()=>[w(n(t.translate("Open")),1)]),_:1},8,["to"]),e.tab==="trashed"?(r(),d("button",{key:0,class:"button",onClick:o=>t.restore(i)},n(t.translate("Restore")),9,he)):v("",!0),e.tab!=="trashed"?(r(),d("button",{key:1,class:"button",onClick:o=>t.trash(i)},n(t.translate("Trash")),9,ge)):(r(),d("button",{key:2,class:"button",onClick:o=>t.trash(i,!0)},n(t.translate("Delete")),9,fe)),l("button",{class:"button",disabled:!t.hasChanges(i),onClick:o=>t.save(i)},n(t.translate("Save")),9,pe)]),(r(!0),d(f,null,b(e.postTypeFields||[],({field:o,priority:k,source:O})=>(r(),d("div",{key:o.slug,class:"field"},[o.type==="select"?g((r(),d("select",{key:0,"onUpdate:modelValue":c=>i[o.slug]=c},[(r(!0),d(f,null,b(o.options?.choices,c=>(r(),d("option",{value:c},n(c),9,ye))),256))],8,ve)),[[_,i[o.slug]]]):o.type==="text"?g((r(),d("input",{key:1,"onUpdate:modelValue":c=>i[o.slug]=c},null,8,be)),[[y,i[o.slug]]]):o.type==="number"?g((r(),d("input",{key:2,type:"number","onUpdate:modelValue":c=>i[o.slug]=c},null,8,ke)),[[y,i[o.slug]]]):o.type==="textarea"?g((r(),d("textarea",{key:3,"onUpdate:modelValue":c=>i[o.slug]=c},null,8,me)),[[y,i[o.slug]]]):o.type==="editor"?g((r(),d("textarea",{key:4,"onUpdate:modelValue":c=>i[o.slug]=c},null,8,Ce)),[[y,i[o.slug]]]):t.controls?.find(c=>c.slug===o.type)?(r(),m(C(t.getControl(o.type)),{key:5,postType:e.slug,modelValue:i[o.slug],"onUpdate:modelValue":c=>i[o.slug]=c,field:o,priority:k,source:O,item:i},null,8,["postType","modelValue","onUpdate:modelValue","field","priority","source","item"])):(r(),d("div",_e,"Unsupported field: "+n(o),1))]))),128)),l("div",Se,[l("input",{readonly:"",value:i?.created_at},null,8,Ie)]),l("div",Ae,[l("input",{readonly:"",value:i?.updated_at},null,8,we)]),e.tab==="trashed"?(r(),d("div",Oe,[l("input",{readonly:"",value:i?.deleted_at},null,8,Ve)])):v("",!0),l("div",{onClick:o=>t.toggleItem(i.id),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[17]||(s[17]=p(()=>{},["stop"])),type:"checkbox",checked:t.isSelected(i.id),onChange:o=>t.toggleItem(i.id)},null,40,Ue)],8,Te)]))),128))]),l("div",Be,[l("div",{onClick:s[20]||(s[20]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-left"},[l("input",{onClick:s[18]||(s[18]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[19]||(s[19]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,Fe)]),l("div",Ne,n(t.translate("Actions")),1),(r(!0),d(f,null,b(e.postTypeFields||[],({field:i,priority:o,source:k})=>(r(),d("div",{key:i.slug,class:"field"},n(t.translate(i.name)),1))),128)),l("div",De,n(t.translate("Created at")),1),l("div",Je,n(t.translate("Updated at")),1),e.tab==="trashed"?(r(),d("div",Me,n(t.translate("Deleted at")),1)):v("",!0),l("div",{onClick:s[23]||(s[23]=(...i)=>t.toggleAll&&t.toggleAll(...i)),class:"checkbox-cell sticky-right"},[l("input",{onClick:s[21]||(s[21]=p(()=>{},["stop"])),type:"checkbox",checked:e.allSelected,onChange:s[22]||(s[22]=(...i)=>t.toggleAll&&t.toggleAll(...i))},null,40,Pe)])])])]),l("div",qe,[l("div",Le,[l("div",je,[g(l("select",{"onUpdate:modelValue":s[24]||(s[24]=i=>e.action=i)},[l("option",null,n(t.translate("Bulk actions")),1),l("option",Ee,n(t.translate("Permanently delete")),1),l("option",We,n(t.translate("Duplicate")),1),l("option",ze,n(t.translate("Save")),1)],512),[[_,e.action]]),l("button",{disabled:!e.action,onClick:s[25]||(s[25]=i=>t.runBulk(e.action))},n(t.translate("Apply")),9,He)]),l("div",Ke,[l("select",null,[l("option",null,n(t.translate("All dates")),1)]),l("select",null,[l("option",null,n(t.translate("All categories")),1)]),l("button",null,n(t.translate("Filter")),1)])]),l("div",Re,[l("span",Ge,n(e.response?.items?.length||0)+" "+n(t.translate("items")),1),l("button",{disabled:e.offset<=0,onClick:s[26]||(s[26]=i=>{e.offset=0,t.getItems()})},"«",8,Qe),l("button",{disabled:e.offset<=0,onClick:s[27]||(s[27]=i=>{e.offset-=e.response?.limit,t.getItems()})},"‹",8,Xe),l("span",Ye,n(Math.floor(e.response?.offset/e.response?.limit)+1||0)+" "+n(t.translate("of"))+" "+n(Math.ceil(e.response?.total_current/e.response?.limit)||0),1),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[28]||(s[28]=i=>{e.offset+=e.response?.limit,t.getItems()})},"›",8,Ze),l("button",{disabled:e.offset+e.response?.limit>=e.response?.total_current,onClick:s[29]||(s[29]=i=>{e.offset=(Math.ceil(e.response?.total_current/e.response?.limit)-1)*e.response?.limit,t.getItems()})},"»",8,$e)])])]))}const tt=V(F,[["render",xe],["__scopeId","data-v-9d0c8549"]]);export{tt as default};
